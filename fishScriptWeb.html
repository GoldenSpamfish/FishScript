<!DOCTYPE html>
<html lang='en'>
<head>
    <link href='fishCSS.css' rel='stylesheet' type='text/css'>
    <link href='codemirror/plugin/codemirror-5.59.2/lib/codemirror.css' rel='stylesheet' type='text/css'>
    <meta charset='UTF-8'>
    <title>fishScript</title>
</head>
<body>

<script src="codemirror/plugin/codemirror-5.59.2/lib/codemirror.js" type="text/javascript"></script>
<script src="codemirror/js/jquery.min.js.js" type="text/javascript"></script>

<div class="topPart">
    <h1>fishScript</h1>
    <p>Welcome to your second favorite scaly creature themed programing language.</p>
</div>

<div class="fullCode">
    <p class="codeHeader">fishScript</p>


    <div class='inputForm'>
        <form>
            <label for='code'></label>
            <textarea class='codemirror-textarea' id='code' name='code' spellcheck="false"></textarea>
        </form>
    </div>

    <button class='runBtn' onclick='fishRunner()' type='button'>â–º</button>

</div>

<script>
    let editor = CodeMirror.fromTextArea(document.getElementById('code'), {
        lineNumbers: true,
        matchBrackets: true,
        mode: "text/x-csrc"
    });

    function fishRunner() {
        let out = '';
        let code = editor.getValue()

        //console.log(code + "works")
        let lines = code.split('>');
        let variables = {};
        for (let i = 0; i < lines.length; i++) {
            while (lines[i].includes('\n')) {
                lines[i] = lines[i].replace('\n', '');
            }
        }
        //console.log(lines)

        // The print function
        function fishPrint(dataIn) {
            if (dataIn[0] === '@') {
                dataIn.shift()
                return ''.concat(dataIn.join(' '))
            } else if (dataIn[0] === '&') {

                return variables[dataIn[1]]
            }
        }

        function variableDef(dataIn) {
            if (dataIn[0] === 'number') {
                dataIn.shift()
                variables[dataIn[0]] = eval(dataIn[2])
            } else if (dataIn[0] === 'word') {
                dataIn.shift()
                dataIn.shift()
                dataIn.shift()
                variables[dataIn[0]] = "".concat(dataIn.join(" "))
            }
        }

        //data = [];

        // ACTUAL RUNNER

        for (let line in lines) {
            let data = lines[line].split(' ')
            //console.log(lines[line])
            //variable definition
            if (data[0] === '&') {
                data.shift();
                variableDef(data);
            }

            //for running functions
            else if (data[0] === '$') {
                data.shift()

                //print function
                if (data.shift() === 'print') {
                    out = out.concat(String(fishPrint(data)) + '<br>')
                }
            }

            //loops
            else if (data[0] === '*') {
                data.shift()

                //for repeat loops(effectively for loops)
                if (data.shift() === 'repeat') {
                    let repeats = eval(data.shift())


                    //repeated printing
                    if (data.shift() === 'print') {
                        let toPrint = fishPrint(data)

                        for (let i = 0; i < repeats; i++) {
                            out = out.concat(String(toPrint) + '<br>')
                        }
                    }
                }
            }
        }
        document.getElementById('output').innerHTML = out;
    }

</script>
<div class="fullOut">

    <p class="outputHeader">Output</p>

    <div class='codeOut'>
        <p id='output'></p>
    </div>

</div>

</body>
</html>