<!DOCTYPE html>
<html lang='en' xmlns="http://www.w3.org/1999/html">
<head>
    <link href='fishCSS.css' rel='stylesheet' type='text/css'>
    <link href='codemirror/plugin/codemirror-5.59.2/lib/codemirror.css' rel='stylesheet' type='text/css'>
    <meta charset='UTF-8'>
    <title>fishScript</title>
</head>
<body>

<script src="codemirror/plugin/codemirror-5.59.2/lib/codemirror.js" type="text/javascript"></script>
<script src="codemirror/js/jquery.min.js.js" type="text/javascript"></script>
<script src="codemirror/plugin/codemirror-5.59.2/mode/fishScript/fish.js" type="text/javascript"></script>
<div class="logo">
    <img alt="FS%20Logo%206.6.png"
         height="110" src="FS%20Logo%206.6.png">
</div>

<div class="topPart">
    <h1>fishScript</h1>
    <p>Welcome to your second favorite scaly creature themed programing language.</p>
</div>

<div class="fullCode">
    <p class="codeHeader">fishScript</p>


    <div class='inputForm'>
        <form>
            <label for='code'></label>
            <textarea class='codemirror-textarea' id='code' name='code' spellcheck="false">>? -------------------------------------------------
>?    \     |-- '    |     /--\          '       |
>? \ / \    |-- | (- |/-\  '--. /-- |/-\ | |--\ -|-
>? / \ /    |   | _) |   | \__/ \__ |    | |__/  |
>?    /                                    |
>? -------------------------------------------------

>? What a cool language am I right?
>? very practical isn't it?
>? well maybe not.
>? But this is the first every code written in fishScript!
>? Behold!

>$ print @ obligatory "hello world!"
>$ print @

>$ print - @ multiline prints are cool,
>$ print @ they let you skip the next new line.

>$ print @

>? defines 3 variables (can make any number of these) (also they can use math!)
>& number num = 1+1*2
>& number othernum = 4
>& number thirdnum = 7.0

>$ print - @ The first number,
>$ print - & num
>$ print - @ , plus the second number,
>$ print - & othernum
>$ print - @ , equals the third number,
>$ print - & thirdnum >$ print @ .
>$ print @

>? you can also use word variables (strings)
>& word hello = hello world
>$ print @ Prints string variable:
>$ print & hello
>$ print @

>? prints out these 3 variables
>$ print @ displays our variables:
    >$ print & num
    >$ print & othernum
    >$ print & thirdnum
    >$ print @
    >? btw tabs dont do anything I just like how they look


>? demonstrates the loop function
>$ print @ prints the value of variable num 3 times:
    >* repeat 3 print & num
    >$ print @

>$ print @ loops also work with text! See?
    >$ print @
    >* repeat 4 print @ knowledge is power
</textarea>
        </form>
    </div>

    <button class='runBtn' onclick='fishRunner()' type='button'>â–º</button>

</div>

<script>
    let editor = CodeMirror.fromTextArea(document.getElementById('code'), {
        lineNumbers: true,
        matchBrackets: true,
        mode: "fish"
    });

    function fishRunner() {
        let out = '';
        let code = editor.getValue()

        //console.log(code + "works")
        let lines = code.split('>');
        let variables = {};
        for (let i = 0; i < lines.length; i++) {
            while (lines[i].includes('\n')) {
                lines[i] = lines[i].replace('\n', '');
            }
        }
        //console.log(lines)

        // The print function
        function fishPrint(dataIn) {
            let printOut = '';
            //console.log(dataIn);
            if ((dataIn[0] === '-')) {
                if (dataIn[1] === '@') {
                    dataIn.shift();
                    dataIn.shift();
                    printOut = printOut + (dataIn.join(' '));

                } else if (dataIn[1] === '&') {
                    printOut = printOut + variables[dataIn[2]];
                }
            } else {
                if (dataIn[0] === '@') {
                    dataIn.shift()
                    printOut = printOut + (dataIn.join(' '));

                } else if (dataIn[0] === '&') {
                    printOut = printOut + (variables[dataIn[1]]);
                }
                printOut = printOut + ('<br>');
            }
            console.log(printOut);
            return printOut;
        }

        function variableDef(dataIn) {
            if (dataIn[0] === 'number') {
                dataIn.shift()
                variables[dataIn[0]] = eval(dataIn[2])
            } else if (dataIn[0] === 'word') {
                dataIn.shift()
                let varName = dataIn[0];
                dataIn.shift()
                dataIn.shift()
                variables[varName] = "".concat(dataIn.join(" "))
            }
        }

        //data = [];

        // ACTUAL RUNNER

        for (let line in lines) {
            let data = lines[line].split(' ')
            //console.log(lines[line])
            //variable definition
            if (data[0] === '&') {
                data.shift();
                variableDef(data);
            }

            //for running functions
            else if (data[0] === '$') {
                data.shift()

                //print function
                if (data.shift() === 'print') {
                    out = out.concat(String(fishPrint(data)))
                }
            }

            //loops
            else if (data[0] === '*') {
                data.shift()

                //for repeat loops(effectively for loops)
                if (data.shift() === 'repeat') {
                    let repeats = eval(data.shift())


                    //repeated printing
                    if (data.shift() === 'print') {
                        let toPrint = fishPrint(data)

                        for (let i = 0; i < repeats; i++) {
                            out = out.concat(String(toPrint))
                        }
                    }
                }
            }
        }
        document.getElementById('output').innerHTML = out;
    }

</script>
<div class="fullOut">

    <p class="outputHeader">Output</p>

    <div class='codeOut'>
        <p id='output'></p>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>


</body>
</html>